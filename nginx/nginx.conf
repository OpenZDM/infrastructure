worker_processes 4;

events {
  worker_connections 1024;
}

http {
  server {
      listen 80;
      charset utf-8;
      server_name localhost;

      location / {
          return 301 https://$host$request_uri;
      }
  }

  server {
      listen 443 ssl;
      charset utf-8;
      server_name localhost;

      ssl_certificate /etc/nginx/ssl/selfsigned.crt;
      ssl_certificate_key /etc/nginx/ssl/selfsigned.key;

      # APICURIO
      location / {
        proxy_pass http://host.docker.internal:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
      }

      # DASHBOARD FRONTEND
        location /dashboard {
            proxy_pass http://v_vwae_frontend:3000/v_vwae_frontend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

        location /v_vwae_frontend/_next/static/ {
            proxy_pass http://v_vwae_frontend:3000/v_vwae_frontend/_next/static/;
        }

      # DASHBOARD BACKEND
        location /dashboardbackend/ {
            proxy_pass http://be_vwae_backend:9000/be_vwae_backend/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /be_vwae_backend/openapi.json {
            proxy_pass http://be_vwae_backend:9000/be_vwae_backend/openapi.json;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

      # MEASURE COMPONENT MICROFRONTEND
        location /measurecomponent {
            proxy_pass http://v_measure_component:3001/v_measure_component;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

        location /v_measure_component/_next/static/ {
            proxy_pass http://v_measure_component:3001/v_measure_component/_next/static/;
        }

      # MEASURE COMPONENT BACKEND
        location /measurecomponentbackend/ {
            proxy_pass http://be_measure_component:9001/be_measure_component/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /be_measure_component/openapi.json {
            proxy_pass http://be_measure_component:9001/be_measure_component/openapi.json;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

      # MEASURE GRAPH COMPONENT MICROFRONTEND
        location /measuregraphcomponent {
            proxy_pass http://v_measure_graph_component:3003/v_measure_graph_component;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

        location /v_measure_graph_component/_next/static/ {
            proxy_pass http://v_measure_graph_component:3003/v_measure_graph_component/_next/static/;
        }

      # NELSON RULES BACKEND
        location /nelsonrules/ {
            proxy_pass http://be_nelson_rules:5567/be_nelson_rules/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /be_nelson_rules/openapi.json {
            proxy_pass http://be_nelson_rules:5567/be_nelson_rules/openapi.json;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
  }
}
